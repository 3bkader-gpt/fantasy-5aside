{% extends "base.html" %}

{% block content %}
{% if is_admin %}
<h1>๐ ุชุณุฌูู ูุชูุฌุฉ ูุจุงุฑุงุฉ (ุงูููุญุฉ ุงูุชูุชูููุฉ)</h1>

<div class="card mb-2" style="border-right: 5px solid var(--warning-color);">
    <h3 style="color: var(--warning-color);">๐ ุฅุฏุงุฑุฉ ุงููุฃุณ</h3>
    <form action="/l/{{ league.slug }}/admin/cup/generate" method="POST">
        <div class="form-group mb-1">
            <input type="password" name="admin_password" placeholder="ูููุฉ ุณุฑ ุงูุฅุฏุงุฑุฉ" required class="form-control"
                style="width: 200px; display: inline-block; margin-inline-end: 1rem;">
            <button type="submit" class="btn" style="background-color: var(--warning-color); color: white;">
                ุฅูุดุงุก ูุฑุนุฉ ุงููุฃุณ (ุฃุนูู 10 ูุงุนุจูู)
            </button>
        </div>
    </form>
    <p class="text-muted mt-1" style="font-size: 0.9rem;">* ุณูุชู ุงุฎุชูุงุฑ ุฃูุถู 10 ูุงุนุจูู ูู ุงูุชุฑุชูุจ ุงูุญุงูู ูุชุณููููู ูู
        ููุงุฌูุงุช
        ุฑุจุน ุงูููุงุฆู.</p>
</div>

<div class="card mb-2" style="border-right: 5px solid var(--danger-color);">
    <h3 style="color: var(--danger-color);">๐จ ุฅููุงุก ุงูุดูุฑ ุงูุญุงูู</h3>
    <form action="/l/{{ league.slug }}/admin/season/end" method="POST"
        onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฅููุงุก ุงูุดูุฑุ ุณูุชู ุฅุถุงูุฉ ุงููุชุตุฏุฑ ุฅูู ููุญุฉ ุงูุดุฑู ูุชุตููุฑ ุฌููุน ุงูููุงุท ุงูุญุงููุฉ!');">
        <input type="text" name="month_name" placeholder="ุงุณู ุงูุดูุฑ (ูุซุงู: ุฃุบุณุทุณ 2026)" required class="form-control"
            style="width: 230px; display: inline-block; margin-inline-end: 0.5rem;">
        <input type="password" name="admin_password" placeholder="ูููุฉ ุณุฑ ุงูุฅุฏุงุฑุฉ" required class="form-control"
            style="width: 180px; display: inline-block; margin-inline-end: 0.5rem;">
        <button type="submit" class="btn btn-danger">
            ุฅููุงุก ุงูุดูุฑ ูุงูุฃุฑุดูุฉ
        </button>
    </form>
    <form action="/l/{{ league.slug }}/admin/season/undo" method="POST" style="margin-top: 1rem;"
        onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุงูุชุฑุงุฌุน ุนู ุฅููุงุก ุงูุดูุฑุ ุณูุชู ุงุณุชุนุงุฏุฉ ุงูููุงุท ูุญุฐู ุขุฎุฑ ุชุณุฌูู ูู ููุญุฉ ุงูุดุฑู.');">
        <input type="password" name="admin_password" placeholder="ูููุฉ ุณุฑ ุงูุฅุฏุงุฑุฉ" required class="form-control"
            style="width: 180px; display: inline-block; margin-inline-end: 0.5rem;">
        <button type="submit" class="btn" style="background: #7f8c8d; color: white; font-size: 0.85rem;">
            โฉ๏ธ ุชุฑุงุฌุน ุนู ุฅููุงุก ุงูุดูุฑ ุงูุฃุฎูุฑ
        </button>
    </form>
</div>

<div class="card mb-2" style="border-right: 5px solid var(--info-color, #3498db);">
    <h3 style="color: var(--info-color, #3498db);">๐ ุชุตุฏูุฑ ุงูุฅุญุตุงุฆูุงุช</h3>
    <a href="/l/{{ league.slug }}/admin/export/stats" class="btn"
        style="background: var(--info-color, #3498db); color: white;">
        ุชุญููู ููู Excel/CSV ๐ฅ
    </a>
    <p class="text-muted mt-1" style="font-size: 0.9rem;">* ูุญุชูู ุงูููู ุนูู ุฌููุน ุฅุญุตุงุฆูุงุช ุงููุงุนุจูู (ุงูููุงุทุ ุงูุฃูุฏุงูุ
        ุงูุฃุณูุณุชุ ุงูุชุตุฏูุงุชุ ูุฃูุซุฑ).</p>
</div>

<div class="card match-form-container">
    <div style="margin-bottom: 30px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px;">
        <h3 style="margin-top:0;">ุชุฃููุฏ ุงูุฅุฏุงุฑุฉ</h3>
        <input type="password" id="admin_password" placeholder="ุฃุฏุฎู ูููุฉ ุณุฑ ุฅุฏุงุฑุฉ ุงูุฏูุฑู ูุญูุธ ุงููุจุงุฑุงุฉ" required
            class="form-control">
    </div>

    <!-- Tactical Board -->
    <div class="tactical-board" style="display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 30px;">

        <!-- Team A -->
        <div class="team-container team-a-container">
            <input type="text" id="team_a_name" value="ูุฑูู ุฃ" class="form-control text-center mb-1"
                style="font-size: 1.5rem; font-weight: bold; border-bottom: 2px solid var(--primary-color);">
            <button id="add-player-a-btn" class="btn btn-primary mb-1" style="width: 100%;">+ ุฅุถุงูุฉ ูุงุนุจ ูููุฑูู</button>
            <div class="table-responsive" style="margin-bottom: 0;">
                <table style="min-width: 700px;">
                    <thead>
                        <tr>
                            <th style="min-width: 120px;">ุงุณู ุงููุงุนุจ</th>
                            <th>โฝ ุฃูุฏุงู</th>
                            <th>๐ ุฃุณูุณุช</th>
                            <th>๐งค ุญุงุฑุณุ</th>
                            <th>โ ุชุตุฏูุงุช</th>
                            <th>โ ุนููู</th>
                            <th>๐ก๏ธ CS</th>
                            <th>ุชุจุฏูู/ุญุฐู</th>
                        </tr>
                    </thead>
                    <tbody id="team-a-body">
                        <!-- Rows -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Team B -->
        <div class="team-container team-b-container">
            <input type="text" id="team_b_name" value="ูุฑูู ุจ" class="form-control text-center mb-1"
                style="font-size: 1.5rem; font-weight: bold; border-bottom: 2px solid var(--warning-color);">
            <button id="add-player-b-btn" class="btn mb-1"
                style="width: 100%; background: var(--warning-color); color: white;">+ ุฅุถุงูุฉ ูุงุนุจ ูููุฑูู</button>
            <div class="table-responsive" style="margin-bottom: 0;">
                <table style="min-width: 700px;">
                    <thead>
                        <tr>
                            <th style="min-width: 120px;">ุงุณู ุงููุงุนุจ</th>
                            <th>โฝ ุฃูุฏุงู</th>
                            <th>๐ ุฃุณูุณุช</th>
                            <th>๐งค ุญุงุฑุณุ</th>
                            <th>โ ุชุตุฏูุงุช</th>
                            <th>โ ุนููู</th>
                            <th>๐ก๏ธ CS</th>
                            <th>ุชุจุฏูู/ุญุฐู</th>
                        </tr>
                    </thead>
                    <tbody id="team-b-body">
                        <!-- Rows -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <button id="save-match-btn" class="btn btn-success" style="width: 100%; padding: 15px; font-size: 1.2rem;">๐พ ุญูุธ
        ุงููุจุงุฑุงุฉ ูุฅูุฑุงุฑ
        ุงููุชูุฌุฉ</button>
</div>

<!-- New Section: League Settings -->
<div class="card mb-4" style="border-right: 5px solid var(--primary-color);">
    <h3 style="color: var(--text-color);">โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุฏูุฑู</h3>
    <form action="/l/{{ league.slug }}/admin/settings/update" method="POST">
        <div class="form-group mb-1">
            <label>ุงุณู ุงูุฏูุฑู ุงูุฌุฏูุฏ (ุงุฎุชูุงุฑู)</label>
            <input type="text" name="name" class="form-control" placeholder="{{ league.name }}">
        </div>
        <div class="form-group mb-1">
            <label>ุงูุฑุงุจุท (Slug) ุงูุฌุฏูุฏ (ุงุฎุชูุงุฑู)</label>
            <input type="text" name="new_slug" class="form-control" value="{{ league.slug }}">
        </div>
        <div class="form-group mb-1">
            <label>ูููุฉ ุงูุณุฑ ุงูุฌุฏูุฏุฉ (ุงุฎุชูุงุฑู)</label>
            <input type="password" name="new_password" class="form-control"
                placeholder="ุฃุฏุฎู ูููุฉ ุณุฑ ุฌุฏูุฏุฉ ุฅุฐุง ุฃุฑุฏุช ุชุบููุฑูุง">
        </div>
        <div class="form-group mb-2">
            <label style="color: var(--danger-color); font-weight: bold;">ูููุฉ ุงูุณุฑ ุงูุญุงููุฉ (ูุทููุจ ููุญูุธ) *</label>
            <input type="password" name="current_admin_password" class="form-control" required
                placeholder="ูุฌุจ ุฅุฏุฎุงู ูููุฉ ุงูุณุฑ ุงูุญุงููุฉ ูุชุฃููุฏ ุงููููุฉ">
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">ุญูุธ ุงูุชุนุฏููุงุช ุงูุดุงููุฉ</button>
    </form>
</div>

<!-- New Section: Player Management -->
<div class="card mb-4" style="border-right: 5px solid var(--secondary-color);">
    <h3 style="color: var(--text-color);">๐ฅ ุฅุฏุงุฑุฉ ุงููุงุนุจูู (ูุณุญ ุงูููุฑุฑ)</h3>
    <p class="text-secondary mb-2">ููููู ููุง ูุณุญ ุฃู ูุงุนุจ ุชู ุฅุถุงูุชู ุจุงูุฎุทุฃ ุฃู ุจุดูู ููุฑุฑ.</p>
    <div
        style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--radius-sm); padding: 10px;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 2px solid var(--border-color);">
                    <th style="text-align: right; padding: 10px;">ุงููุงุนุจ</th>
                    <th style="text-align: right; padding: 10px;">ุงูููุงุท</th>
                    <th style="text-align: center; padding: 10px;">ุงูุฅุฌุฑุงุก</th>
                </tr>
            </thead>
            <tbody>
                {% for player in players %}
                <tr style="border-bottom: 1px solid var(--border-color);">
                    <td style="padding: 10px;">{{ player.name }}</td>
                    <td style="padding: 10px;">{{ player.total_points }}</td>
                    <td style="padding: 10px; text-align: center;">
                        <button class="btn btn-danger btn-sm delete-player-btn" data-player-id="{{ player.id }}"
                            data-player-name="{{ player.name }}">
                            ูุณุญ ููุงุฆูุงู
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Danger Zone -->
<div class="card mb-4" style="border: 2px solid var(--danger-color); background: rgba(231, 76, 60, 0.05);">
    <h3 style="color: var(--danger-color);">โ๏ธ ููุทูุฉ ุงูุฎุทุฑ (Danger Zone)</h3>
    <p class="text-secondary mb-2">ุญุฐู ุงูุฏูุฑู ุณูุคุฏู ุฅูู ูุณุญ ุฌููุน ุงููุงุนุจููุ ุงููุจุงุฑูุงุชุ ูุงูุฅุญุตุงุฆูุงุช ูุชุงุฑูุฎ ุงููุฃุณ ุงูุฎุงุต
        ุจุงูุฏูุฑู ููุงุฆูุงู. ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก ุชุญุช ุฃู ุธุฑู.</p>
    <button type="button" class="btn delete-league-btn" data-league-slug="{{ league.slug }}"
        style="background-color: var(--danger-color); color: white; width: 100%;">
        ๐๏ธ ุญุฐู ุงูุฏูุฑู ููุงุฆูุงู
    </button>
</div>

<!-- Template for a new row (hidden) -->
<template id="player-row-template">
    <tr class="player-row">
        <td data-label="ุงูุงุณู">
            <input type="text" class="player-name-input form-control" placeholder="ุงุณู ุงููุงุนุจ">
        </td>
        <td data-label="ุฃูุฏุงู">
            <input type="number" class="goals-input form-control" value="0" min="0"
                style="min-width: 50px; padding: 5px;">
        </td>
        <td data-label="ุฃุณูุณุช">
            <input type="number" class="assists-input form-control" value="0" min="0"
                style="min-width: 50px; padding: 5px;">
        </td>
        <td data-label="ุญุงุฑุณุ">
            <input type="checkbox" class="is-gk-check">
        </td>
        <td data-label="ุชุตุฏูุงุช">
            <input type="number" class="saves-input form-control" value="0" min="0" disabled
                style="min-width: 50px; padding: 5px; opacity: 0.5;">
        </td>
        <td data-label="ุฃูุฏุงู ุนููู">
            <input type="number" class="conceded-input form-control" value="0" min="0" disabled
                style="min-width: 50px; padding: 5px; opacity: 0.5;">
        </td>
        <td data-label="CS">
            <input type="checkbox" class="clean-sheet-check" disabled style="opacity: 0.5;">
        </td>
        <td data-label="ุงูุฅุฌุฑุงุก" style="white-space: nowrap;">
            <button class="swap-row-btn" title="ุงููู ุงููุงุนุจ ูููุฑูู ุงูุขุฎุฑ"
                style="background-color: var(--primary-color); color: white; border: none; padding: 5px 10px; border-radius: var(--radius-sm); cursor: pointer; margin-inline-start: 5px;">๐</button>
            <button class="remove-row-btn" title="ุญุฐู"
                style="background-color: var(--danger-color); color: white; border: none; padding: 5px 10px; border-radius: var(--radius-sm); cursor: pointer;">X</button>
        </td>
    </tr>
</template>

<script>
    window.LEAGUE_SLUG = "{{ league.slug }}";
</script>
<script src="/static/js/admin_dashboard.js"></script>
{% else %}
<div class="alert alert-danger text-center" style="margin-top: 5rem; padding: 3rem;">
    <h2>๐ซ Access Denied / ูุตูู ุบูุฑ ูุณููุญ</h2>
    <p style="font-size: 1.2rem; margin-top: 1rem;">ูุฐู ุงูุตูุญุฉ ูุฎุตุตุฉ ููุณุคููู ุงูุฏูุฑู ููุท.</p>
    <a href="/l/{{ league.slug }}" class="btn btn-primary mt-2">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</a>
</div>
{% endif %}
{% endblock %}